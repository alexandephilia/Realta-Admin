<!DOCTYPE html>
<h4 class="mb-3 text-body mb-0">Job Listings</h4>
<div class="card">
    <div class="card-body">
        <div class="text-end">
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createJobModal">
                <span class="fas fa-plus me-2"></span>Add New Job
            </button>
        </div>

        <!-- Create Job Modal -->
        <div class="modal fade" id="createJobModal" tabindex="-1" aria-labelledby="createJobModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="createJobModalLabel">Create New Job Listing</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createJobForm">
                            <div class="row g-3">
                                <!-- Left Column -->
                                <div class="col-12 col-lg-4">
                                    <!-- Job Details Card -->
                                    <div class="card">
                                        <div class="card-body p-3">
                                            <h6 class="mb-3">Job Details</h6>
                                            <div class="mb-3">
                                                <label class="form-label" for="department">Department</label>
                                                <select class="form-select" id="department" name="department" required>
                                                    <option value="">Select Department</option>
                                                    <option value="IT">Information Technology</option>
                                                    <option value="HR">Human Resources</option>
                                                    <option value="FIN">Finance & Accounting</option>
                                                    <option value="SALES">Sales & Marketing</option>
                                                    <option value="OPS">Operations</option>
                                                    <option value="RND">Research & Development</option>
                                                    <option value="PROJ">Project Management</option>
                                                    <option value="QA">Quality Assurance</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="position">Position</label>
                                                <select class="form-select" id="position" name="position" required
                                                    disabled>
                                                    <option value="">Select Position</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="opportunity">Employment Type</label>
                                                <select class="form-select" id="opportunity" required disabled>
                                                    <option value="">Select Type</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="location">Location</label>
                                                <select class="form-select" id="location" required disabled>
                                                    <option value="">Select Location</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column -->
                                <div class="col-12 col-lg-8">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <!-- Title -->
                                                <div class="col-12">
                                                    <label class="form-label" for="jobTitle">Job Title</label>
                                                    <input type="text" class="form-control" id="jobTitle" required>
                                                </div>

                                                <!-- Salary Range -->
                                                <div class="col-md-6">
                                                    <label class="form-label" for="salaryMin">Salary Range</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="salaryMin"
                                                            placeholder="Min">
                                                        <span class="input-group-text">to</span>
                                                        <input type="number" class="form-control" id="salaryMax"
                                                            placeholder="Max">
                                                    </div>
                                                </div>

                                                <!-- Experience -->
                                                <div class="col-md-6">
                                                    <label class="form-label" for="experience">Experience
                                                        Required</label>
                                                    <select class="form-select" id="experience" required>
                                                        <option value="">Select Experience</option>
                                                        <option value="fresh">Fresh Graduate</option>
                                                        <option value="1-3">1-3 Years</option>
                                                        <option value="3-5">3-5 Years</option>
                                                        <option value="5+">5+ Years</option>
                                                    </select>
                                                </div>

                                                <!-- Status Switch -->
                                                <div class="col-12 d-flex justify-content-end">
                                                    <div class="form-check form-switch me-4">
                                                        <input class="form-check-input" type="checkbox" id="jobStatus"
                                                            checked>
                                                        <label class="form-check-label" for="jobStatus">
                                                            Job Status
                                                            <span class="ms-1 text-success status-text">Active</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Job Description - Full Width -->
                                <div class="col-12">
                                    <label class="form-label" for="jobDescription">Job Description</label>
                                    <textarea id="jobDescription" class="tinymce-editor"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" form="createJobForm" class="btn btn-primary">Create Job</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Listings Table -->
        <div class="table-responsive mt-4">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="text-center">Job Title</th>
                        <th class="text-center">Department</th>
                        <th class="text-center">Position</th>
                        <th class="text-center">Opportunity</th>
                        <th class="text-center">Location</th>
                        <th class="text-center">Experience</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">Senior Software Engineer</td>
                        <td class="text-center">Information Technology</td>
                        <td class="text-center">Software Engineer</td>
                        <td class="text-center">Full Time</td>
                        <td class="text-center">Jakarta</td>
                        <td class="text-center">3-5 Years</td>
                        <td class="text-center">
                            <span class="badge badge-phoenix fs-10 badge-phoenix-success">
                                <span class="fa fa-check"></span>
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-falcon-default text-danger" data-bs-toggle="modal"
                                data-bs-target="#deleteJobModal">
                                <span class="fas fa-trash-alt"></span>
                            </button>
                            <button class="btn btn-sm btn-falcon-default text-warning" data-bs-toggle="modal"
                                data-bs-target="#editJobModal">
                                <span class="fas fa-edit me-2"></span>Edit
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">Business Analyst Intern</td>
                        <td class="text-center">Research & Development</td>
                        <td class="text-center">Business Analyst</td>
                        <td class="text-center">Internship</td>
                        <td class="text-center">Semarang</td>
                        <td class="text-center">Fresh Graduate</td>
                        <td class="text-center">
                            <span class="badge badge-phoenix fs-10 badge-phoenix-success">
                                <span class="fa fa-check"></span>
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-falcon-default text-danger" data-bs-toggle="modal"
                                data-bs-target="#deleteJobModal">
                                <span class="fas fa-trash-alt"></span>
                            </button>
                            <button class="btn btn-sm btn-falcon-default text-warning" data-bs-toggle="modal"
                                data-bs-target="#editJobModal">
                                <span class="fas fa-edit me-2"></span>Edit
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Delete Job Modal -->
        <div class="modal fade" id="deleteJobModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Attention</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">Are you sure you want to delete this job listing?</div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger">Yes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Job Modal -->
        <div class="modal fade" id="editJobModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Job Listing</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Same form structure as create modal, with 'edit' prefix on IDs -->
                        <form id="editJobForm">
                            <div class="row g-3">
                                <!-- Left Column -->
                                <div class="col-12 col-lg-4">
                                    <div class="card">
                                        <div class="card-body p-3">
                                            <h6 class="mb-3">Job Details</h6>
                                            <div class="mb-3">
                                                <label class="form-label" for="editDepartment">Department</label>
                                                <select class="form-select" id="editDepartment" name="department"
                                                    required>
                                                    <option value="">Select Department</option>
                                                    <option value="IT">Information Technology</option>
                                                    <option value="HR">Human Resources</option>
                                                    <option value="FIN">Finance & Accounting</option>
                                                    <option value="SALES">Sales & Marketing</option>
                                                    <option value="OPS">Operations</option>
                                                    <option value="RND">Research & Development</option>
                                                    <option value="PROJ">Project Management</option>
                                                    <option value="QA">Quality Assurance</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="editPosition">Position</label>
                                                <select class="form-select" id="editPosition" name="position" required
                                                    disabled>
                                                    <option value="">Select Position</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="editOpportunity">Employment Type</label>
                                                <select class="form-select" id="editOpportunity" required disabled>
                                                    <option value="">Select Type</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" for="editLocation">Location</label>
                                                <select class="form-select" id="editLocation" required disabled>
                                                    <option value="">Select Location</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column -->
                                <div class="col-12 col-lg-8">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-12">
                                                    <label class="form-label" for="editJobTitle">Job Title</label>
                                                    <input type="text" class="form-control" id="editJobTitle" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label" for="editSalaryMin">Salary Range</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="editSalaryMin"
                                                            placeholder="Min">
                                                        <span class="input-group-text">to</span>
                                                        <input type="number" class="form-control" id="editSalaryMax"
                                                            placeholder="Max">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label" for="editExperience">Experience
                                                        Required</label>
                                                    <select class="form-select" id="editExperience" required>
                                                        <option value="">Select Experience</option>
                                                        <option value="fresh">Fresh Graduate</option>
                                                        <option value="1-3">1-3 Years</option>
                                                        <option value="3-5">3-5 Years</option>
                                                        <option value="5+">5+ Years</option>
                                                    </select>
                                                </div>
                                                <div class="col-12 d-flex justify-content-end">
                                                    <div class="form-check form-switch me-4">
                                                        <input class="form-check-input" type="checkbox"
                                                            id="editJobStatus" checked>
                                                        <label class="form-check-label" for="editJobStatus">
                                                            Job Status
                                                            <span class="ms-1 text-success status-text">Active</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Job Description - Full Width -->
                                <div class="col-12">
                                    <label class="form-label" for="editJobDescription">Job Description</label>
                                    <textarea id="editJobDescription" class="tinymce-editor"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" form="editJobForm" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#">Previous</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<!-- Add this script at the bottom of the file -->
<script>
    // Sample data structure (in real app, this would come from your backend)
    const departmentData = {
        'IT': {
            positions: [{
                    code: 'SE',
                    name: 'Software Engineer'
                },
                {
                    code: 'PM',
                    name: 'Project Manager'
                },
                {
                    code: 'BA',
                    name: 'Business Analyst'
                }
            ],
            locations: ['Jakarta', 'Semarang', 'Bali'],
            types: ['Full Time', 'Internship']
        },
        'HR': {
            positions: [{
                    code: 'HR',
                    name: 'HR Specialist'
                },
                {
                    code: 'RC',
                    name: 'Recruiter'
                }
            ],
            locations: ['Jakarta', 'Semarang', 'Bali'],
            types: ['Full Time']
        }
    };

    // Function to populate dependent dropdowns
    function populateDependentDropdowns(departmentId, positionId, locationId, typeId) {
        const departmentSelect = document.getElementById(departmentId);
        const positionSelect = document.getElementById(positionId);
        const locationSelect = document.getElementById(locationId);
        const typeSelect = document.getElementById(typeId);

        departmentSelect.addEventListener('change', function () {
            const department = this.value;
            const departmentInfo = departmentData[department];

            // Clear and disable dropdowns if no department selected
            if (!department) {
                positionSelect.innerHTML = '<option value="">Select Position</option>';
                locationSelect.innerHTML = '<option value="">Select Location</option>';
                typeSelect.innerHTML = '<option value="">Select Type</option>';
                positionSelect.disabled = true;
                locationSelect.disabled = true;
                typeSelect.disabled = true;
                return;
            }

            // Populate positions
            positionSelect.innerHTML = '<option value="">Select Position</option>';
            departmentInfo.positions.forEach(position => {
                positionSelect.add(new Option(position.name, position.code));
            });
            positionSelect.disabled = false;

            // Populate locations
            locationSelect.innerHTML = '<option value="">Select Location</option>';
            departmentInfo.locations.forEach(location => {
                locationSelect.add(new Option(location, location));
            });
            locationSelect.disabled = false;

            // Populate types
            typeSelect.innerHTML = '<option value="">Select Type</option>';
            departmentInfo.types.forEach(type => {
                typeSelect.add(new Option(type, type.toLowerCase().replace(' ', '')));
            });
            typeSelect.disabled = false;
        });
    }

    // Initialize dropdowns for create form
    populateDependentDropdowns('department', 'position', 'location', 'opportunity');

    // Initialize dropdowns for edit form
    populateDependentDropdowns('editDepartment', 'editPosition', 'editLocation', 'editOpportunity');

    // Handle status toggle for both create and edit modals
    ['jobStatus', 'editJobStatus'].forEach(id => {
        document.getElementById(id).addEventListener('change', function () {
            const statusText = this.parentElement.querySelector('.status-text');
            if (this.checked) {
                statusText.textContent = 'Active';
                statusText.classList.remove('text-danger');
                statusText.classList.add('text-success');
            } else {
                statusText.textContent = 'Inactive';
                statusText.classList.remove('text-success');
                statusText.classList.add('text-danger');
            }
        });
    });

    // Handle edit button clicks
    document.querySelectorAll('.btn-falcon-default.text-warning').forEach(button => {
        button.addEventListener('click', function () {
            const row = this.closest('tr');

            // Get data from the row
            const jobTitle = row.cells[0].textContent.trim();
            const department = row.cells[1].textContent.trim();
            const position = row.cells[2].textContent.trim();
            const type = row.cells[3].textContent.trim();
            const location = row.cells[4].textContent.trim();
            const experience = row.cells[5].textContent.trim();
            const isActive = row.cells[6].querySelector('.badge-phoenix-success') !== null;

            // Populate the edit modal
            document.getElementById('editJobTitle').value = jobTitle;

            // Map department text to value
            const departmentMap = {
                'Information Technology': 'IT',
                'Human Resources': 'HR',
                'Finance & Accounting': 'FIN',
                'Sales & Marketing': 'SALES',
                'Operations': 'OPS',
                'Research & Development': 'RND',
                'Project Management': 'PROJ',
                'Quality Assurance': 'QA'
            };
            document.getElementById('editDepartment').value = departmentMap[department] || '';

            // Map position text to value
            const positionMap = {
                'Software Engineer': 'SE',
                'Project Manager': 'PM',
                'Business Analyst': 'BA',
                'QA Engineer': 'QAE',
                'UI/UX Designer': 'UI',
                'Database Administrator': 'DBA',
                'Developer': 'DEV',
                'System Analyst': 'SA',
                'Network Engineer': 'NET',
                'Security Specialist': 'SEC',
                'HR Specialist': 'HR',
                'Accountant': 'ACC',
                'Marketing Specialist': 'MKT',
                'Sales Executive': 'SALES'
            };
            document.getElementById('editPosition').value = positionMap[position] || '';

            // Handle opportunity value mapping
            document.getElementById('editOpportunity').value = type === 'Full Time' ? 'fulltime' :
                'internship';
            document.getElementById('editLocation').value = location;
            document.getElementById('editExperience').value = experience.toLowerCase().replace(' ', '');

            // Set the status switch
            const statusSwitch = document.getElementById('editJobStatus');
            const statusText = statusSwitch.parentElement.querySelector('.status-text');
            statusSwitch.checked = isActive;

            if (isActive) {
                statusText.textContent = 'Active';
                statusText.classList.remove('text-danger');
                statusText.classList.add('text-success');
            } else {
                statusText.textContent = 'Inactive';
                statusText.classList.remove('text-success');
                statusText.classList.add('text-danger');
            }
        });
    });

    // Separate the TinyMCE initialization into its own function
    function initializeTinyMCE() {
        tinymce.init({
            selector: '.tinymce-editor',
            height: 400,
            menubar: false,
            branding: false,
            statusbar: false,
            plugins: [
                'lists', 'link', 'image', 'code', 'table', 'help'
            ],
            toolbar: 'styles | bold italic | alignleft aligncenter alignright | bullist numlist | link image | removeformat',
            content_style: `
                body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 14px; }
                p { margin: 0 0 1em; }
            `,
            setup: function (editor) {
                editor.on('init', function () {
                    const editorContainer = editor.getContainer();
                    const customStyles = document.createElement('style');
                    customStyles.textContent = `
                        .tox-toolbar__group:has(.tox-tbtn--select) {
                            width: auto !important;
                            flex: 0 0 auto !important;
                        }
                        .tox-tbtn.tox-tbtn--select {
                            width: 200px !important;
                            min-width: 200px !important;
                        }
                        .tox-tbtn__select-label {
                            width: auto !important;
                            flex-grow: 1 !important;
                        }
                    `;
                    editorContainer.appendChild(customStyles);
                });
            }
        });
    }

    // Initialize TinyMCE when modals are shown
    $('#createJobModal').on('shown.bs.modal', function () {
        tinymce.remove('.tinymce-editor'); // Remove existing instances first
        initializeTinyMCE();
    });

    $('#editJobModal').on('shown.bs.modal', function () {
        tinymce.remove('.tinymce-editor'); // Remove existing instances first
        initializeTinyMCE();
    });

    // Clean up TinyMCE instances when modals are hidden
    $('#createJobModal, #editJobModal').on('hidden.bs.modal', function () {
        tinymce.remove('.tinymce-editor');
    });
</script>