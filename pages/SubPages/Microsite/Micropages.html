<!DOCTYPE html>
<h4 class="mb-3 text-body mb-0">Microsite Pages</h4>
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <select class="form-select form-select-sm" id="micrositeFilter" style="width: auto;">
                    <option value="">All Pages</option>
                </select>
            </div>
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addPageModal">
                <span class="fas fa-plus me-2"></span>Add New Page
            </button>
        </div>

        <!-- Add Page Modal -->
        <div class="modal fade" id="addPageModal" tabindex="-1" aria-labelledby="addPageModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="modal-title" id="addPageModalLabel">
                            <i class="fas fa-plus me-2"></i>Add New Page
                        </h5>
                        <div class="d-flex align-items-center">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="addPageForm">
                            <div class="row g-3">
                                <!-- Left Column -->
                                <div class="col-12 col-lg-4">
                                    <!-- Basic Information Card -->
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">Page Configuration</h6>
                                        </div>
                                        <div class="card-body">
                                            <!-- Page Details -->
                                            <div class="mb-4">
                                                <h6 class="mb-3">Page Details</h6>
                                                <div class="mb-3">
                                                    <label class="form-label fw-semibold" for="pageName">Page Name</label>
                                                    <input type="text" class="form-control" id="pageName" name="pageName"
                                                        placeholder="Enter page name">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label fw-semibold" for="urlSlug">URL Slug</label>
                                                    <input type="text" class="form-control" id="urlSlug" name="urlSlug"
                                                        placeholder="Enter URL slug">
                                                </div>
                                            </div>

                                            <!-- Display Settings -->
                                            <div class="mb-4">
                                                <h6 class="mb-3">Page Settings</h6>
                                                <div class="d-flex justify-content-end pe-4">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox"
                                                            id="pageStatus" name="pageStatus" checked>
                                                        <label class="form-check-label ms-2" for="pageStatus">
                                                            Status: <span class="text-success status-text">Active</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column -->
                                <div class="col-12 col-lg-8">
                                    <!-- Content Card -->
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">SEO Configuration</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold" for="metaTitle">Meta Title</label>
                                                    <input type="text" class="form-control" id="metaTitle" name="metaTitle"
                                                        placeholder="Enter meta title">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold" for="hashtagInput">SEO Keywords</label>
                                                    <div class="input-group mb-2">
                                                        <input type="text" class="form-control" id="hashtagInput"
                                                            placeholder="Enter keyword and press Enter">
                                                    </div>
                                                    <small class="text-muted mb-2 d-block">Separate multiple keywords with Enter key</small>
                                                    <div class="hashtag-container d-flex flex-wrap gap-2">
                                                        <!-- Tags will be dynamically added here -->
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label fw-semibold" for="metaDescription">Meta Description</label>
                                                    <textarea class="form-control" id="metaDescription" name="metaDescription" rows="3"
                                                        placeholder="Enter meta description" maxlength="1600"></textarea>
                                                    <div class="d-flex justify-content-between align-items-center mt-1">
                                                        <small class="text-muted">
                                                            Characters: <span id="charCount">0</span>/1600
                                                        </small>
                                                        <button type="button" class="btn btn-falcon-default btn-sm"
                                                            onclick="showSourceCode(this.closest('.col-12').querySelector('#metaDescription').value)">
                                                            <span class="fas fa-code me-1"></span>Copy source code
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer bg-light">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" form="addPageForm" class="btn btn-primary">Add Page</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Page Modal -->
        <div class="modal fade" id="editPageModal" tabindex="-1" aria-labelledby="editPageModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="modal-title" id="editPageModalLabel">
                            <i class="fas fa-edit me-2"></i>Edit Page
                        </h5>
                        <div class="d-flex align-items-center">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="editPageForm">
                            <input type="hidden" id="editPageId" name="editPageId">
                            <div class="row g-3">
                                <!-- Left Column -->
                                <div class="col-12 col-lg-4">
                                    <!-- Basic Information Card -->
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">Page Configuration</h6>
                                        </div>
                                        <div class="card-body">
                                            <!-- Page Details -->
                                            <div class="mb-4">
                                                <h6 class="mb-3">Page Details</h6>
                                                <div class="mb-3">
                                                    <label class="form-label fw-semibold" for="editPageName">Page Name</label>
                                                    <input type="text" class="form-control" id="editPageName" name="editPageName"
                                                        placeholder="Enter page name">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label fw-semibold" for="editUrlSlug">URL Slug</label>
                                                    <input type="text" class="form-control" id="editUrlSlug" name="editUrlSlug"
                                                        placeholder="Enter URL slug">
                                                </div>
                                            </div>

                                            <!-- Display Settings -->
                                            <div class="mb-4">
                                                <h6 class="mb-3">Page Settings</h6>
                                                <div class="d-flex justify-content-end pe-4">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox"
                                                            id="editPageStatus" name="editPageStatus">
                                                        <label class="form-check-label ms-2" for="editPageStatus">
                                                            Status: <span class="text-success status-text">Active</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column -->
                                <div class="col-12 col-lg-8">
                                    <!-- Content Card -->
                                    <div class="card h-100">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">SEO Configuration</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold" for="editMetaTitle">Meta Title</label>
                                                    <input type="text" class="form-control" id="editMetaTitle" name="editMetaTitle"
                                                        placeholder="Enter meta title">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label fw-semibold" for="editHashtagInput">SEO Keywords</label>
                                                    <div class="input-group mb-2">
                                                        <input type="text" class="form-control" id="editHashtagInput"
                                                            placeholder="Enter keyword and press Enter">
                                                    </div>
                                                    <small class="text-muted mb-2 d-block">Separate multiple keywords with Enter key</small>
                                                    <div class="hashtag-container d-flex flex-wrap gap-2">
                                                        <!-- Tags will be dynamically added here -->
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label fw-semibold" for="editMetaDescription">Meta Description</label>
                                                    <textarea class="form-control" id="editMetaDescription" name="editMetaDescription" rows="3"
                                                        placeholder="Enter meta description" maxlength="1600"></textarea>
                                                    <div class="d-flex justify-content-between align-items-center mt-1">
                                                        <small class="text-muted">
                                                            Characters: <span id="editCharCount">0</span>/1600
                                                        </small>
                                                        <button type="button" class="btn btn-falcon-default btn-sm"
                                                            onclick="showSourceCode(this.closest('.col-12').querySelector('#editMetaDescription').value)">
                                                            <span class="fas fa-code me-1"></span>Copy source code
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer bg-light">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" form="editPageForm" class="btn btn-warning">Update Page</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Section -->
        <div class="table-responsive mt-4">
            <table class="table table-hover" id="pagesTable">
                <thead>
                    <tr>
                        <th class="text-center">Page Name</th>
                        <th class="text-center">URL Slug</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-page='{"id": "1", "name": "Home Page", "urlSlug": "/home", "status": true, "metaTitle": "Home Page", "metaDescription": "Welcome to our homepage", "keywords": ["home", "welcome", "main"]}'>
                        <td class="text-center">Home Page</td>
                        <td class="text-center">/home</td>
                        <td class="text-center">
                            <span class="badge badge-phoenix fs-10 badge-phoenix-success">
                                <span class="fa fa-check"></span>
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-falcon-default text-danger" data-bs-toggle="modal"
                                data-bs-target="#deletePageModal">
                                <span class="fas fa-trash-alt"></span>
                            </button>
                            <button class="btn btn-sm btn-falcon-default text-warning" onclick="handleEdit(this)">
                                <span class="fas fa-edit me-2"></span>Edit
                            </button>
                        </td>
                    </tr>
                    <tr data-page='{"id": "2", "name": "About Us", "urlSlug": "/about", "status": false, "metaTitle": "About Us", "metaDescription": "Learn more about our company", "keywords": ["about", "company", "info"]}'>
                        <td class="text-center">About Us</td>
                        <td class="text-center">/about</td>
                        <td class="text-center">
                            <span class="badge badge-phoenix fs-10 badge-phoenix-danger">
                                <span class="fa fa-xmark"></span>
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-falcon-default text-danger" data-bs-toggle="modal"
                                data-bs-target="#deletePageModal">
                                <span class="fas fa-trash-alt"></span>
                            </button>
                            <button class="btn btn-sm btn-falcon-default text-warning" onclick="handleEdit(this)">
                                <span class="fas fa-edit me-2"></span>Edit
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Delete Page Modal -->
        <div class="modal fade" id="deletePageModal" tabindex="-1" aria-labelledby="deletePageModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletePageModalLabel">Delete Page</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this page? This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#">Previous</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>

        <!-- Source Code Modal -->
        <div class="modal fade" id="sourceCodeModal" tabindex="-1" aria-labelledby="sourceCodeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="sourceCodeModalLabel">Meta Tags Source Code</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group mb-3">
                            <label class="form-label">HTML Meta Tags</label>
                            <textarea class="form-control font-monospace" id="sourceCodeText" rows="6" readonly></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Open Graph Meta Tags</label>
                            <textarea class="form-control font-monospace" id="ogSourceCodeText" rows="4" readonly></textarea>
                        </div>
                        <div class="text-end mt-3">
                            <div class="btn-group">
                                <button type="button" class="btn btn-falcon-default btn-sm"
                                    onclick="copySourceCode('sourceCodeText')">
                                    <span class="fas fa-copy me-1"></span>Copy HTML Tags
                                </button>
                                <button type="button" class="btn btn-falcon-default btn-sm"
                                    onclick="copySourceCode('ogSourceCodeText')">
                                    <span class="fas fa-copy me-1"></span>Copy OG Tags
                                </button>
                                <button type="button" class="btn btn-falcon-default btn-sm" onclick="copyAllSourceCode()">
                                    <span class="fas fa-copy me-1"></span>Copy All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Handle page status toggle for both modals
            ['pageStatus', 'editPageStatus'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', function () {
                    const statusText = this.closest('.form-check').querySelector('.status-text');
                    if (this.checked) {
                        statusText.textContent = 'Active';
                        statusText.classList.remove('text-danger');
                        statusText.classList.add('text-success');
                    } else {
                        statusText.textContent = 'Inactive';
                        statusText.classList.remove('text-success');
                        statusText.classList.add('text-danger');
                    }
                });
            });

            // Handle hashtag input for both modals
            ['hashtagInput', 'editHashtagInput'].forEach(id => {
                document.getElementById(id)?.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const value = this.value.trim();
                        if (value) {
                            const container = this.closest('.col-12').querySelector('.hashtag-container');
                            const tag = document.createElement('div');
                            tag.className = 'badge badge-phoenix badge-phoenix-primary d-flex align-items-center gap-1';
                            tag.innerHTML = `
                                ${value}
                                <span class="fas fa-times cursor-pointer" onclick="this.parentElement.remove()"></span>
                            `;
                            container.appendChild(tag);
                            this.value = '';
                        }
                    }
                });
            });

            // Update character counter for META description in both modals
            ['metaDescription', 'editMetaDescription'].forEach(id => {
                document.getElementById(id)?.addEventListener('input', function () {
                    const charCount = this.value.length;
                    const counter = this.closest('.col-12').querySelector('[id$="charCount"]');
                    counter.textContent = charCount;

                    if (charCount > 1500) {
                        counter.classList.add('text-warning');
                    } else {
                        counter.classList.remove('text-warning');
                    }
                });
            });

            // Function to create a table row from page data
            function createTableRow(pageData) {
                const row = document.createElement('tr');
                row.setAttribute('data-page', JSON.stringify(pageData));
                
                row.innerHTML = `
                    <td class="text-center">${pageData.name}</td>
                    <td class="text-center">${pageData.urlSlug}</td>
                    <td class="text-center">
                        <span class="badge badge-phoenix fs-10 badge-phoenix-${pageData.status ? 'success' : 'danger'}">
                            <span class="fa fa-${pageData.status ? 'check' : 'xmark'}"></span>
                        </span>
                    </td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-falcon-default text-danger" data-bs-toggle="modal"
                            data-bs-target="#deletePageModal">
                            <span class="fas fa-trash-alt"></span>
                        </button>
                        <button class="btn btn-sm btn-falcon-default text-warning" onclick="handleEdit(this)">
                            <span class="fas fa-edit me-2"></span>Edit
                        </button>
                    </td>
                `;
                
                return row;
            }

            // Function to handle edit button click
            function handleEdit(button) {
                const row = button.closest('tr');
                const pageData = JSON.parse(row.getAttribute('data-page'));
                openEditModal(pageData);
            }

            // Function to open edit modal with data
            function openEditModal(pageData) {
                const modal = document.getElementById('editPageModal');
                if (!modal) return;

                // Fill in the form fields
                document.getElementById('editPageId').value = pageData.id;
                document.getElementById('editPageName').value = pageData.name;
                document.getElementById('editUrlSlug').value = pageData.urlSlug;
                document.getElementById('editMetaTitle').value = pageData.metaTitle;
                document.getElementById('editMetaDescription').value = pageData.metaDescription;
                
                // Set status
                const statusToggle = document.getElementById('editPageStatus');
                statusToggle.checked = pageData.status;
                statusToggle.dispatchEvent(new Event('change'));

                // Clear and add keywords
                const container = modal.querySelector('.hashtag-container');
                container.innerHTML = '';
                if (pageData.keywords && Array.isArray(pageData.keywords)) {
                    pageData.keywords.forEach(keyword => {
                        const tag = document.createElement('div');
                        tag.className = 'badge badge-phoenix badge-phoenix-primary d-flex align-items-center gap-1';
                        tag.innerHTML = `
                            ${keyword}
                            <span class="fas fa-times cursor-pointer" onclick="this.parentElement.remove()"></span>
                        `;
                        container.appendChild(tag);
                    });
                }

                // Update character counter
                const descriptionField = document.getElementById('editMetaDescription');
                const counter = modal.querySelector('#editCharCount');
                counter.textContent = pageData.metaDescription?.length || 0;

                // Show the modal using Bootstrap's Modal class
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
            }

            // Remove the old event listeners for edit buttons
            document.querySelectorAll('button.text-warning').forEach(btn => {
                btn.removeAttribute('data-bs-toggle');
                btn.removeAttribute('data-bs-target');
            });

            // Function to confirm page deletion
            function confirmDelete() {
                // Add your delete logic here
                $('#deletePageModal').modal('hide');
            }

            // Add the SEO-related functions from blogList.html
            function showSourceCode(text) {
                // Get the current active modal
                const currentModal = document.querySelector('.modal.show');
                
                // Determine which form we're working with
                let titleElement, keywordsContainer;
                if (currentModal) {
                    if (currentModal.id === 'editPageModal') {
                        titleElement = document.querySelector('#editPageName');
                        keywordsContainer = currentModal.querySelector('.hashtag-container');
                    } else if (currentModal.id === 'addPageModal') {
                        titleElement = document.querySelector('#pageName');
                        keywordsContainer = currentModal.querySelector('.hashtag-container');
                    }
                }

                // Get values
                const title = titleElement?.value || '';
                const keywords = Array.from(keywordsContainer?.querySelectorAll('.badge') || [])
                    .map(tag => tag.textContent.trim())
                    .join(', ');

                // Generate HTML meta tags
                const htmlMetaTags = `<!-- Primary Meta Tags -->
<title>${title}</title>
<meta name="title" content="${title}">
<meta name="description" content="${text}">
<meta name="keywords" content="${keywords}">`;

                // Generate Open Graph meta tags
                const ogMetaTags = `<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:title" content="${title}">
<meta property="og:description" content="${text}">`;

                // Update modal content
                document.getElementById('sourceCodeText').value = htmlMetaTags;
                document.getElementById('ogSourceCodeText').value = ogMetaTags;

                const sourceCodeModal = document.getElementById('sourceCodeModal');
                
                if (currentModal) {
                    const currentZIndex = parseInt(getComputedStyle(currentModal).zIndex);
                    sourceCodeModal.style.zIndex = currentZIndex + 2;
                    
                    const modal = new bootstrap.Modal(sourceCodeModal);
                    modal.show();
                    
                    setTimeout(() => {
                        const backdrop = document.querySelector('.modal-backdrop:last-child');
                        if (backdrop) {
                            backdrop.style.zIndex = currentZIndex + 1;
                            backdrop.style.opacity = '0.5';
                        }
                    }, 0);
                    
                    sourceCodeModal.addEventListener('hidden.bs.modal', function handler() {
                        sourceCodeModal.style.zIndex = '';
                        this.removeEventListener('hidden.bs.modal', handler);
                    });
                } else {
                    const modal = new bootstrap.Modal(sourceCodeModal);
                    modal.show();
                }
            }

            // Function to copy specific source code to clipboard
            function copySourceCode(elementId) {
                const textArea = document.getElementById(elementId);
                textArea.select();
                
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(textArea.value);
                    } else {
                        document.execCommand('copy');
                    }
                    
                    const copyBtn = event.currentTarget;
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<span class="fas fa-check me-1"></span>Copied!';
                    copyBtn.classList.add('btn-success');

                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.classList.remove('btn-success');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    const tempTextArea = document.createElement('textarea');
                    tempTextArea.value = textArea.value;
                    document.body.appendChild(tempTextArea);
                    tempTextArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempTextArea);
                }
            }

            // Function to copy all source code
            function copyAllSourceCode() {
                const htmlTags = document.getElementById('sourceCodeText').value;
                const ogTags = document.getElementById('ogSourceCodeText').value;
                const allTags = `${htmlTags}\n\n${ogTags}`;
                
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(allTags);
                    } else {
                        const tempTextArea = document.createElement('textarea');
                        tempTextArea.value = allTags;
                        document.body.appendChild(tempTextArea);
                        tempTextArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempTextArea);
                    }
                    
                    const copyBtn = event.currentTarget;
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<span class="fas fa-check me-1"></span>All Copied!';
                    copyBtn.classList.add('btn-success');

                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.classList.remove('btn-success');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    const tempTextArea = document.createElement('textarea');
                    tempTextArea.value = allTags;
                    document.body.appendChild(tempTextArea);
                    tempTextArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempTextArea);
                }
            }

            // Function to get keywords from a container
            function getKeywordsFromContainer(container) {
                return Array.from(container.querySelectorAll('.badge'))
                    .map(tag => tag.textContent.trim());
            }

            // Function to update microsite filter options
            function updateMicrositeFilter() {
                const filter = document.getElementById('micrositeFilter');
                const rows = document.querySelectorAll('#pagesTable tbody tr');
                const pageNames = new Set(['']); // Start with empty option
                
                // Get all existing page names from the table
                rows.forEach(row => {
                    const data = JSON.parse(row.getAttribute('data-page'));
                    pageNames.add(data.name);
                });
                
                // Clear existing options
                filter.innerHTML = '';
                
                // Add options in alphabetical order
                Array.from(pageNames)
                    .sort()
                    .forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name || 'All Pages';
                        filter.appendChild(option);
                    });
            }

            // Add form submission handler
            document.getElementById('addPageForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const pageData = {
                    id: Date.now().toString(), // Generate temporary ID
                    name: document.getElementById('pageName').value,
                    urlSlug: document.getElementById('urlSlug').value,
                    status: document.getElementById('pageStatus').checked,
                    metaTitle: document.getElementById('metaTitle').value,
                    metaDescription: document.getElementById('metaDescription').value,
                    keywords: getKeywordsFromContainer(this.querySelector('.hashtag-container'))
                };

                // Validate required fields
                if (!pageData.name || !pageData.urlSlug) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Add new row to table
                const tableBody = document.querySelector('#pagesTable tbody');
                const newRow = createTableRow(pageData);
                tableBody.appendChild(newRow);

                // Update filter options
                updateMicrositeFilter();

                // Close modal and reset form
                const modal = bootstrap.Modal.getInstance(document.getElementById('addPageModal'));
                modal.hide();
                this.reset();
                this.querySelector('.hashtag-container').innerHTML = '';
            });

            // Edit form submission handler
            document.getElementById('editPageForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const pageData = {
                    id: document.getElementById('editPageId').value,
                    name: document.getElementById('editPageName').value,
                    urlSlug: document.getElementById('editUrlSlug').value,
                    status: document.getElementById('editPageStatus').checked,
                    metaTitle: document.getElementById('editMetaTitle').value,
                    metaDescription: document.getElementById('editMetaDescription').value,
                    keywords: getKeywordsFromContainer(this.querySelector('.hashtag-container'))
                };

                // Validate required fields
                if (!pageData.name || !pageData.urlSlug) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Find and update existing row
                const rows = document.querySelectorAll('#pagesTable tbody tr');
                let existingRow = null;
                
                rows.forEach(row => {
                    const rowData = JSON.parse(row.getAttribute('data-page'));
                    if (rowData.id === pageData.id) {
                        existingRow = row;
                    }
                });

                if (existingRow) {
                    const newRow = createTableRow(pageData);
                    existingRow.replaceWith(newRow);
                }

                // Update filter options
                updateMicrositeFilter();

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editPageModal'));
                modal.hide();
            });

            // Initialize filter with existing data and update select element
            const micrositeFilter = document.getElementById('micrositeFilter');
            micrositeFilter.innerHTML = `
                <option value="">All Pages</option>
                <option value="Home Page">Home Page</option>
                <option value="About Us">About Us</option>
            `;

            // Add filter functionality
            micrositeFilter.addEventListener('change', function() {
                const selectedValue = this.value.toLowerCase();
                const rows = document.querySelectorAll('#pagesTable tbody tr');
                
                rows.forEach(row => {
                    const pageData = JSON.parse(row.getAttribute('data-page'));
                    const pageName = pageData.name.toLowerCase();
                    
                    if (!selectedValue || pageName === selectedValue) {
                        row.style.display = ''; // Show row
                    } else {
                        row.style.display = 'none'; // Hide row
                    }
                });
            });

            // Reset forms when modals are closed
            ['addPageModal', 'editPageModal'].forEach(modalId => {
                document.getElementById(modalId)?.addEventListener('hidden.bs.modal', function() {
                    const form = this.querySelector('form');
                    if (form) {
                        form.reset();
                        form.querySelector('.hashtag-container').innerHTML = '';
                    }
                });
            });
        </script>
    </div>
</div>
